<!DOCTYPE html>
<!--
 *  Copyright (c) 2014 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
-->
<html>

<head>

  <title>WebRTC Reference App</title>

  <meta charset="utf-8">
  <meta name="description" content="WebRTC reference app">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
  <link rel="canonical" href="{{ room_link }}">
  <link rel="stylesheet" href="/css/main.css">

</head>

<body>
  <!--
   * Keep the HTML id attributes in sync with |uiConstants| defined in
   * appcontroller.js.
  -->
  <div id="videos">
    <video id="mini-video" autoplay muted></video>
    <canvas id="remote-canvas"></canvas>
    <video id="remote-video" autoplay></video>
    <video id="local-video" autoplay muted></video>
  </div>

  <footer>
    <div id="sharing-div">
      <div id="room-link">Waiting for someone to join this room: <a href="{{ room_link }}" target="_blank">{{ room_link }}</a></div>
    </div>
    <div id="info-div"></div>
    <div id="status-div"></div>
  </footer>

  <script src="/js/util.js"></script>
  <script src="/js/stats.js"></script>
  {{ include_loopback_js }}
  <script src="/js/signalingchannel.js"></script>
  <script src="/js/sdputils.js"></script>
  <script src="/js/peerconnectionclient.js"></script>
  <script src="/js/call.js"></script>
  <script src="/js/infobox.js"></script>
  <script src="/js/appcontroller.js"></script>
  {{ include_vr_js }}
  <script src="/js/adapter.js"></script>

  <script type="text/javascript">
    var params = {
      errorMessages: {{ error_messages }},
      isLoopback: {{ is_loopback }},

      roomId: '{{ room_id }}',
      roomLink: '{{ room_link }}',

      mediaConstraints: {{ media_constraints | safe }},
      offerConstraints: {{ offer_constraints | safe }},
      peerConnectionConfig: {{ pc_config | safe }},
      peerConnectionConstraints: {{ pc_constraints | safe }},
      turnRequestUrl: '{{ turn_url }}',
      turnTransports: '{{ turn_transports }}',

      audioSendBitrate: '{{ asbr }}',
      audioSendCodec: '{{ audio_send_codec }}',
      audioRecvBitrate: '{{ arbr }}',
      audioRecvCodec: '{{ audio_receive_codec }}',
      opusMaxPbr: '{{ opusmaxpbr }}',
      opusFec: '{{ opusfec }}',
      videoSendBitrate: '{{ vsbr }}',
      videoSendInitialBitrate: '{{ vsibr }}',
      videoSendCodec: '{{ video_send_codec }}',
      videoRecvBitrate: '{{ vrbr }}',
      videoRecvCodec: '{{ video_receive_codec }}',
      wssUrl: '{{ wss_url }}',
      wssPostUrl: '{{ wss_post_url }}'
    };

    var appController;

    function initialize() {
      // We don't want to continue if this is triggered from Chrome prerendering,
      // since it will register the user to GAE without cleaning it up, causing
      // the real navigation to get a "full room" error. Instead we'll initialize
      // once the visibility state changes to non-prerender.
      if (document.webkitVisibilityState === 'prerender') {
        document.addEventListener('webkitvisibilitychange', onVisibilityChange);
        return;
      }
      appController = new AppController(params);
    }

    function onVisibilityChange() {
      if (document.webkitVisibilityState === 'prerender') {
        return;
      }
      document.removeEventListener('webkitvisibilitychange', onVisibilityChange);
      initialize();
    }

    initialize();
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48530561-2', 'auto');
    ga('send', 'pageview');
  </script>

</body>
</html>
